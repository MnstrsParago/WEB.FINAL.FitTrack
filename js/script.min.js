function isValidEmail(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}if(document.addEventListener("DOMContentLoaded",()=>{let e=document.getElementById("registerForm"),t=document.getElementById("loginForm");if(e&&e.addEventListener("submit",e=>{e.preventDefault();let t=document.getElementById("fullName").value.trim(),a=document.getElementById("email").value.trim(),l=document.getElementById("password").value,n=document.getElementById("confirmPassword").value,s=document.getElementById("termsCheck").checked,i=document.getElementById("registerAlert"),r=!0;if(i.classList.add("d-none"),document.querySelectorAll(".is-invalid").forEach(e=>e.classList.remove("is-invalid")),""===t&&(document.getElementById("fullName").classList.add("is-invalid"),r=!1),""!==a&&isValidEmail(a)||(document.getElementById("email").classList.add("is-invalid"),r=!1),l.length<8&&(document.getElementById("password").classList.add("is-invalid"),r=!1),l!==n&&(document.getElementById("confirmPassword").classList.add("is-invalid"),r=!1),s||(document.getElementById("termsCheck").classList.add("is-invalid"),r=!1),r){let d={fullName:t,email:a,password:l};localStorage.setItem("user_"+a,JSON.stringify(d)),alert("Registration successful! You can now log in."),window.location.href="login.html"}else i.classList.remove("d-none"),i.textContent="Please correct the errors in the form."}),t){let a=localStorage.getItem("rememberedEmail");a&&(document.getElementById("loginEmail").value=a,document.getElementById("rememberMe").checked=!0),t.addEventListener("submit",e=>{e.preventDefault();let t=document.getElementById("loginEmail").value.trim(),a=document.getElementById("loginPassword").value,l=document.getElementById("loginAlert"),n=!0;if(l.classList.add("d-none"),document.querySelectorAll(".is-invalid").forEach(e=>e.classList.remove("is-invalid")),""!==t&&isValidEmail(t)||(document.getElementById("loginEmail").classList.add("is-invalid"),n=!1),""===a&&(document.getElementById("loginPassword").classList.add("is-invalid"),n=!1),n){let s="user_"+t,i=JSON.parse(localStorage.getItem(s));i&&i.password===a?(localStorage.setItem("currentUser",JSON.stringify({email:t,name:i.fullName})),document.getElementById("rememberMe").checked?localStorage.setItem("rememberedEmail",t):localStorage.removeItem("rememberedEmail"),alert("Login successful!"),window.location.href="dashboard.html"):(l.classList.remove("d-none"),l.textContent="Invalid email or password.")}else l.classList.remove("d-none"),l.textContent="Please enter a valid email and password."})}let l=document.getElementById("addTaskBtn"),n=document.getElementById("saveTaskBtn"),s=document.getElementById("cancelTaskBtn"),i=document.getElementById("taskForm"),r=document.getElementById("tasksList");if(l&&i){let d=[{id:1,name:"Run 5km",goal:"5km",progress:3},{id:2,name:"Do 50 Push-ups",goal:"50 reps",progress:30},{id:3,name:"Yoga Session",goal:"30 minutes",progress:15},];function o(){r.innerHTML="",d.forEach(e=>{let t=document.createElement("div");t.className="task-card",t.dataset.id=e.id;let a=0,l=0;e.goal.includes("km")?(l=Number.parseFloat(e.goal),a=e.progress/l*100):e.goal.includes("reps")?(l=Number.parseInt(e.goal),a=e.progress/l*100):e.goal.includes("minutes")&&(l=Number.parseInt(e.goal),a=e.progress/l*100),a=Math.min(Math.max(a,0),100),t.innerHTML=`
                    <div class="task-header">
                        <h3 class="task-title">${e.name}</h3>
                        <div class="task-actions">
                            <button class="btn btn-sm btn-outline-primary edit-task-btn" data-id="${e.id}">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-danger delete-task-btn" data-id="${e.id}">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                    <div class="task-progress">
                        <div class="task-progress-label">
                            <span>Progress: ${e.progress} / ${e.goal}</span>
                            <span>${a.toFixed(0)}%</span>
                        </div>
                        <div class="progress">
                            <div class="progress-bar" role="progressbar" style="width: ${a}%" 
                                aria-valuenow="${a}" aria-valuemin="0" aria-valuemax="100"></div>
                        </div>
                    </div>
                `,r.appendChild(t)}),document.querySelectorAll(".edit-task-btn").forEach(e=>{e.addEventListener("click",function(){let e=Number.parseInt(this.dataset.id);m(e)})}),document.querySelectorAll(".delete-task-btn").forEach(e=>{e.addEventListener("click",function(){let e=Number.parseInt(this.dataset.id);c(e)})})}function m(e){let t=d.find(t=>t.id===e);t&&(document.getElementById("taskName").value=t.name,document.getElementById("taskGoal").value=t.goal,document.getElementById("taskProgress").value=t.progress,d=d.filter(t=>t.id!==e),i.classList.remove("d-none"))}function c(e){confirm("Are you sure you want to delete this task?")&&(d=d.filter(t=>t.id!==e),o())}function g(){document.getElementById("taskName").value="",document.getElementById("taskGoal").value="",document.getElementById("taskProgress").value=""}l.addEventListener("click",()=>{i.classList.remove("d-none")}),s.addEventListener("click",()=>{i.classList.add("d-none"),g()}),n.addEventListener("click",()=>{let e=document.getElementById("taskName").value.trim(),t=document.getElementById("taskGoal").value.trim(),a=Number.parseInt(document.getElementById("taskProgress").value)||0;if(""===e||""===t){alert("Please fill in all fields");return}let l={id:Date.now(),name:e,goal:t,progress:a};d.push(l),o(),i.classList.add("d-none"),g()}),o();let u=document.getElementById("weeklyChart");if(u){let p=u.getContext("2d");new Chart(p,{type:"bar",data:{labels:["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday",],datasets:[{label:"Steps",data:[8e3,10500,9200,7800,12e3,9500,8500],backgroundColor:"rgba(76, 175, 80, 0.5)",borderColor:"rgba(76, 175, 80, 1)",borderWidth:1},{label:"Calories Burned",data:[350,450,400,320,500,420,380],backgroundColor:"rgba(255, 87, 34, 0.5)",borderColor:"rgba(255, 87, 34, 1)",borderWidth:1},]},options:{responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0}}}})}}let v=document.getElementById("randomChallengeBtn"),E=document.getElementById("challengeResult");if(v&&E){let I=["jumping jacks","push-ups","squats","lunges","mountain climbers","burpees","sit-ups","high knees","plank seconds","crunches",];v.addEventListener("click",()=>{let e=Math.floor(100*Math.random())+1,t=e%2==0,a=t?"even":"odd",l=e>50,n=l?"greater than 50":"less than or equal to 50",s=I[Math.floor(Math.random()*I.length)],i=`Your number is ${e} â€” it's ${a} and ${n}!`,r=`Your challenge: Do ${e} ${s}!`,d="alert-primary";d=e>75?"alert-danger":e>50?"alert-warning":e>25?"alert-info":"alert-success",E.innerHTML=`
        <div class="challenge-number">${e}</div>
        <div class="challenge-message">${i}</div>
        <div class="challenge-exercise">${r}</div>
        <div class="alert ${d} challenge-alert">
          <i class="fas fa-info-circle"></i> 
          ${l?"This is a challenging workout!":"This is a good starter workout!"}
        </div>
      `,$(E).hide().removeClass("d-none").fadeIn(500)})}let y=document.getElementById("addMealBtn"),f=document.getElementById("saveMealBtn"),b=document.getElementById("cancelMealBtn"),h=document.getElementById("mealForm"),B=document.getElementById("mealsTableBody");if(y&&h){let k=[{id:1,meal:"Breakfast",food:"Oatmeal with Berries",calories:350,protein:15,carbs:45,fats:10},{id:2,meal:"Lunch",food:"Grilled Chicken Salad",calories:420,protein:35,carbs:20,fats:15},{id:3,meal:"Dinner",food:"Salmon with Vegetables",calories:480,protein:40,carbs:25,fats:20},];y.addEventListener("click",()=>{h.classList.remove("d-none")}),b.addEventListener("click",()=>{h.classList.add("d-none"),x()}),f.addEventListener("click",()=>{let e=document.getElementById("mealName").value.trim(),t=document.getElementById("foodItem").value.trim(),a=Number.parseInt(document.getElementById("calories").value)||0,l=Number.parseInt(document.getElementById("protein").value)||0,n=Number.parseInt(document.getElementById("carbs").value)||0,s=Number.parseInt(document.getElementById("fats").value)||0;if(""===e||""===t){alert("Please fill in all required fields");return}let i={id:Date.now(),meal:e,food:t,calories:a,protein:l,carbs:n,fats:s};k.push(i),L(),h.classList.add("d-none"),x()});let _=document.getElementById("filterBtn"),C=document.getElementById("resetFilterBtn");function L(e=k){if(!B)return;B.innerHTML="";let t=0,a=0,l=0,n=0;e.forEach(e=>{let s=document.createElement("tr");s.dataset.id=e.id,s.innerHTML=`
                    <td>${e.meal}</td>
                    <td>${e.food}</td>
                    <td>${e.calories}</td>
                    <td>${e.protein}</td>
                    <td>${e.carbs}</td>
                    <td>${e.fats}</td>
                    <td>
                        <button class="btn btn-sm btn-outline-danger delete-meal-btn" data-id="${e.id}">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `,B.appendChild(s),t+=e.calories,a+=e.protein,l+=e.carbs,n+=e.fats}),document.getElementById("totalCalories").textContent=t,document.getElementById("totalProtein").textContent=a,document.getElementById("totalCarbs").textContent=l,document.getElementById("totalFats").textContent=n,document.querySelectorAll(".delete-meal-btn").forEach(e=>{e.addEventListener("click",function(){let e=Number.parseInt(this.dataset.id);w(e)})}),M(t,a,l,n)}function w(e){confirm("Are you sure you want to delete this meal?")&&(k=k.filter(t=>t.id!==e),L())}function x(){document.getElementById("mealName").value="",document.getElementById("foodItem").value="",document.getElementById("calories").value="",document.getElementById("protein").value="",document.getElementById("carbs").value="",document.getElementById("fats").value=""}function M(e,t,a,l){let n=document.getElementById("calorieChart"),s=document.getElementById("macroChart");if(n){let i=Number.parseInt(document.getElementById("calorieGoal").textContent.replace(/,/g,""))||2e3,r=n.getContext("2d");window.calorieChartInstance&&window.calorieChartInstance.destroy(),window.calorieChartInstance=new Chart(r,{type:"doughnut",data:{labels:["Consumed","Remaining"],datasets:[{data:[e,Math.max(0,i-e)],backgroundColor:["rgba(76, 175, 80, 0.8)","rgba(238, 238, 238, 0.8)",],borderColor:["rgba(76, 175, 80, 1)","rgba(238, 238, 238, 1)"],borderWidth:1},]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{title:{display:!0,text:"Calorie Goal Progress"}}}})}if(s){let d=s.getContext("2d");window.macroChartInstance&&window.macroChartInstance.destroy(),window.macroChartInstance=new Chart(d,{type:"bar",data:{labels:["Protein","Carbs","Fats"],datasets:[{label:"Grams",data:[t,a,l],backgroundColor:["rgba(33, 150, 243, 0.8)","rgba(255, 193, 7, 0.8)","rgba(255, 87, 34, 0.8)",],borderColor:["rgba(33, 150, 243, 1)","rgba(255, 193, 7, 1)","rgba(255, 87, 34, 1)",],borderWidth:1},]},options:{responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0}},plugins:{title:{display:!0,text:"Macronutrient Distribution"}}}})}}_&&C&&(_.addEventListener("click",()=>{let e=Number.parseInt(document.getElementById("minCalories").value)||0,t=Number.parseInt(document.getElementById("maxCalories").value)||Number.POSITIVE_INFINITY,a=k.filter(a=>a.calories>=e&&a.calories<=t);L(a)}),C.addEventListener("click",()=>{document.getElementById("minCalories").value="",document.getElementById("maxCalories").value="",L()}));let P=document.querySelectorAll(".edit-goal-btn"),A=document.getElementById("saveGoalBtn");if(P.length&&A){let S="";P.forEach(e=>{e.addEventListener("click",function(){S=this.dataset.goal;let e=document.getElementById(`${S}Goal`).textContent.replace(/[^0-9]/g,"");document.getElementById("editGoalTitle").textContent=`Edit ${S.charAt(0).toUpperCase()+S.slice(1)} Goal`,document.getElementById("goalValue").value=e;let t=new bootstrap.Modal(document.getElementById("editGoalModal"));t.show()})}),A.addEventListener("click",()=>{let e=document.getElementById("goalValue").value;if(e&&S){let t=e;t="calories"===S?Number.parseInt(e).toLocaleString():`${e}g`,document.getElementById(`${S}Goal`).textContent=t,bootstrap.Modal.getInstance(document.getElementById("editGoalModal")).hide();let a=Number.parseInt(document.getElementById("totalCalories").textContent),l=Number.parseInt(document.getElementById("totalProtein").textContent),n=Number.parseInt(document.getElementById("totalCarbs").textContent),s=Number.parseInt(document.getElementById("totalFats").textContent);M(a,l,n,s)}})}L()}let T=document.getElementById("groupsContainer");if(T){let G=[{id:1,name:"Running Club",description:"Join fellow runners for training tips, race information, and motivation.",members:1250,image:"../images/Running_Club.webp"},{id:2,name:"Vegan Fitness",description:"Plant-based nutrition and workout plans for optimal health and performance.",members:875,image:"../images/Vegan_Fitness.webp"},{id:3,name:"HIIT Warriors",description:"High-intensity interval training workouts and challenges for maximum results.",members:1540,image:"../images/HIIT_Warriors.webp"},{id:4,name:"Yoga & Meditation",description:"Find balance with yoga practices and mindfulness techniques for body and mind.",members:2100,image:"../images/Yoga&Meditation.webp"},];G.forEach(e=>{let t=document.createElement("div");t.className="col-md-6 col-lg-3 mb-4",t.innerHTML=`
                <div class="card group-card">
                    <img src="${e.image}" class="card-img-top group-card-img" alt="${e.name}" loading="lazy">
                    <div class="card-body">
                        <h5 class="card-title">${e.name}</h5>
                        <p class="card-text text-muted">${e.members.toLocaleString()} members</p>
                        <div class="d-flex justify-content-between align-items-center">
                            <button class="btn btn-primary join-group-btn" data-id="${e.id}">Join Group</button>
                            <button class="btn btn-link details-toggle" data-id="${e.id}">
                                <i class="fas fa-chevron-down"></i> Details
                            </button>
                        </div>
                    </div>
                    <div class="group-details" id="details-${e.id}">
                        <p>${e.description}</p>
                    </div>
                </div>
            `,T.appendChild(t)}),document.querySelectorAll(".join-group-btn").forEach(e=>{e.addEventListener("click",function(){let e=this.dataset.id,t=G.find(t=>t.id===Number.parseInt(e));t&&(alert(`You have joined the ${t.name} group!`),this.textContent="Joined",this.classList.remove("btn-primary"),this.classList.add("btn-success"),this.disabled=!0)})}),document.querySelectorAll(".details-toggle").forEach(e=>{e.addEventListener("click",function(){let e=this.dataset.id,t=document.getElementById(`details-${e}`);if(t){$(t).slideToggle(300);let a=this.querySelector("i");a.classList.contains("fa-chevron-down")?(a.classList.remove("fa-chevron-down"),a.classList.add("fa-chevron-up")):(a.classList.remove("fa-chevron-up"),a.classList.add("fa-chevron-down"))}})})}}),isValid){let e={fullName:fullName,email:email,password:password};localStorage.setItem("user_"+email,JSON.stringify(e)),alert("Registration successful!"),window.location.href="login.html"}if(isValid){let t="user_"+email,a=JSON.parse(localStorage.getItem(t));a&&a.password===password?(localStorage.setItem("currentUser",JSON.stringify({email:email,name:a.fullName})),document.getElementById("rememberMe").checked?localStorage.setItem("rememberedEmail",email):localStorage.removeItem("rememberedEmail"),alert("Login successful!"),window.location.href="dashboard.html"):(loginAlert.classList.remove("d-none"),loginAlert.textContent="Invalid email or password.")}const rememberedEmail=localStorage.getItem("rememberedEmail");rememberedEmail&&(document.getElementById("loginEmail").value=rememberedEmail,document.getElementById("rememberMe").checked=!0);